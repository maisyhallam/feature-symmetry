---
title: "feature-distinction-proportions"
author: "Maisy Hallam"
date: "2023-05-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) # for data preprocessing
library(ggplot2) # for plotting
library(lme4) # for model fitting
```

# Preprocessing the data

## Import the data

```{r}
gender_data <- read_csv('../../data/raw/gender_proportion_data.csv')
age_data <- read_csv('../../data/raw/age_proportion_data.csv')
side_data <- read_csv('../../data/raw/side_proportion_data.csv')
```
We can combine these into a giant dataframe, to make any mutations slightly easier. First, let's add a column so we know which data pertains to which feature.

```{r}
gender_data <- gender_data %>%
  mutate(feature = 'gender')
age_data <- age_data %>%
  mutate(feature = 'age')
side_data <- side_data %>%
  mutate(feature = 'side')

```

Then we can bind these three dataframes into one: `all_data`.

```{r}
all_data <- rbind(gender_data,age_data,side_data)
```


Now, if we filter by `feature` and `data_type`, we can take a sample of 1000 rows of the simulation data and the kinbank data, for plotting purposes. 

```{r}
sim_ge_sample = sample_n(filter(all_data, data_type == 'simulation', feature == 'gender'), 1000, replace=FALSE)
kb_ge_sample = sample_n(filter(all_data, data_type == 'kinbank', feature == 'gender'), 1000, replace=FALSE)

sim_ag_sample = sample_n(filter(all_data, data_type == 'simulation', feature == 'age'), 1000, replace=FALSE)
kb_ag_sample = sample_n(filter(all_data, data_type == 'kinbank', feature == 'age'), 1000, replace=FALSE)

sim_si_sample = sample_n(filter(all_data, data_type == 'simulation', feature == 'side'), 1000, replace=FALSE)
kb_si_sample = sample_n(filter(all_data, data_type == 'kinbank', feature == 'side'), 1000, replace=FALSE)

```

## Plots

```{r}
rbind(sim_ge_sample,kb_ge_sample) %>%
  ggplot(aes(x=generation_n, y=`generation_n+1`,color=data_type)) +
  geom_jitter(alpha=0.2,width = 0.2) +
  xlim(0,1) +
  ylim(0,1) +
  geom_smooth(method=lm)
```

```{r}
rbind(sim_ag_sample,kb_ag_sample) %>%
  ggplot(aes(x=generation_n, y=`generation_n+1`,color=data_type)) +
  geom_jitter(alpha=0.2,width = 0.2) +
  xlim(0,1) +
  ylim(0,1) +
  geom_smooth(method=lm)
```

```{r}
rbind(sim_si_sample,kb_si_sample) %>%
  ggplot(aes(x=generation_n, y=`generation_n+1`,color=data_type)) +
  geom_jitter(alpha=0.2,width = 0.2) +
  xlim(0,1) +
  ylim(0,1) +
  geom_smooth(method=lm)
```

## Super serious stats

Gender correlation

```{r}
sim_gender <- filter(gender_data, data_type == 'simulation')
kb_gender <- filter(gender_data,data_type == 'kinbank')

sim_age <- filter(age_data, data_type == 'simulation')
kb_age <- filter(age_data,data_type == 'kinbank')

sim_gender <- filter(side_data, data_type == 'simulation')
kb_gender <- filter(side_data,data_type == 'kinbank')
```

```{r}
cor.test(sim_gender$generation_n,sim_gender$`generation_n+1`, method = 'spearman')

```

```{r}
cor.test(kb_gender$generation_n,kb_gender$`generation_n+1`, method = 'spearman')
```

Age correlation

```{r}
cor.test(sim_age$generation_n,sim_age$`generation_n+1`, method = 'spearman')

```

```{r}
cor.test(kb_age$generation_n,kb_age$`generation_n+1`, method = 'spearman')
```

